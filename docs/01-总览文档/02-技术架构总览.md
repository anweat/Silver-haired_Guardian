# 银龄守候·双模交互版 - 技术架构总览

> 文档版本：v1.0  
> 更新日期：2025年12月21日  
> 文档状态：已完成

---

## 目录

- [1. 系统架构概述](#1-系统架构概述)
- [2. 技术选型](#2-技术选型)
- [3. 系统架构图](#3-系统架构图)
- [4. 部署架构](#4-部署架构)
- [5. 安全架构](#5-安全架构)
- [6. 性能要求](#6-性能要求)

---

## 1. 系统架构概述

### 1.1 架构设计原则
| 原则 | 说明 |
|:----|:----|
| **高可用性** | 系统可用性目标99.9%，关键服务具备故障转移能力 |
| **可扩展性** | 采用微服务架构，支持水平扩展 |
| **安全性** | 端到端加密，隐私数据保护 |
| **低延迟** | 语音交互响应<500ms，消息推送<1s |
| **适老化** | 客户端轻量化，支持低端设备 |

### 1.2 分层架构设计

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户层 (User Layer)                        │
│  ┌─────────────────────┐          ┌─────────────────────┐        │
│  │    老年端 APP        │  <---->   │    子女端 APP/小程序  │        │
│  │  (Android/iOS)      │          │  (Android/iOS/Web)  │        │
│  └─────────────────────┘          └─────────────────────┘        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       接入层 (Access Layer)                       │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │ API网关   │  │ 负载均衡  │  │ WebSocket │  │ CDN加速  │         │
│  │ (Kong)   │  │ (Nginx)  │  │  Server  │  │          │         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       服务层 (Service Layer)                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │ 用户服务  │  │ 健康服务  │  │ 消息服务  │  │ AI服务   │         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │ 安全服务  │  │ 提醒服务  │  │ 文件服务  │  │ 分析服务  │         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       数据层 (Data Layer)                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │  MySQL   │  │  Redis   │  │   OSS    │  │   MQ     │         │
│  │ (主数据库) │  │  (缓存)  │  │(对象存储) │  │(消息队列) │         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      外部服务 (External Services)                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │ 语音识别  │  │ OCR识别  │  │ 推送服务  │  │ 诈骗号码库 │         │
│  │(讯飞/百度)│  │ (阿里云) │  │(极光/个推)│  │          │         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

## 2. 技术选型

### 2.1 客户端技术栈

#### 老年端 APP (Android为主)
| 技术领域 | 技术选型 | 选型理由 |
|:--------|:--------|:--------|
| 开发语言 | Kotlin | 现代Android官方推荐语言，代码简洁 |
| UI框架 | Jetpack Compose | 声明式UI，适合构建响应式界面 |
| 架构模式 | MVVM + Clean Architecture | 清晰分层，便于测试和维护 |
| 网络通信 | Retrofit + OkHttp | 成熟稳定，支持拦截器 |
| 实时通信 | WebSocket (OkHttp) | 低延迟消息推送 |
| 语音处理 | SpeechRecognizer + 讯飞SDK | 在线离线双模式 |
| 图像处理 | CameraX + ML Kit | 相机简化，本地预处理 |
| 动画引擎 | Lottie | 轻量级矢量动画，虚拟形象 |
| 依赖注入 | Hilt | Google官方DI框架 |
| 本地存储 | Room + DataStore | 结构化数据 + KV存储 |

#### 子女端 APP
| 技术领域 | 技术选型 | 选型理由 |
|:--------|:--------|:--------|
| 跨平台框架 | Flutter | 一套代码多端运行，开发效率高 |
| 状态管理 | Riverpod | 类型安全，易于测试 |
| 网络通信 | Dio | 功能丰富的HTTP客户端 |
| 推送服务 | Firebase + 极光 | 覆盖国内外推送需求 |

### 2.2 后端技术栈

| 技术领域 | 技术选型 | 版本 | 选型理由 |
|:--------|:--------|:----|:--------|
| 开发语言 | Java | 17 LTS | 生态成熟，人才丰富 |
| 基础框架 | Spring Boot | 3.2.x | 企业级标准框架 |
| 微服务框架 | Spring Cloud Alibaba | 2022.x | 国内生态完善 |
| API网关 | Spring Cloud Gateway | 4.1.x | 与Spring生态无缝集成 |
| 服务注册 | Nacos | 2.3.x | 服务发现+配置中心二合一 |
| 数据库 | MySQL | 8.0+ | 关系型数据主存储 |
| 缓存 | Redis | 7.x | 高性能缓存，会话管理 |
| 消息队列 | RabbitMQ | 3.12+ | 可靠消息传递 |
| 对象存储 | 阿里云OSS | - | 语音、图片文件存储 |
| 搜索引擎 | Elasticsearch | 8.x | 日志分析、全文检索 |
| 定时任务 | XXL-Job | 2.4.x | 分布式任务调度 |

### 2.3 AI能力技术栈

| AI能力 | 主选方案 | 备选方案 | 说明 |
|:------|:--------|:--------|:----|
| 语音识别(ASR) | 讯飞开放平台 | 百度智能云 | 支持流式识别，方言支持好 |
| 语音合成(TTS) | 讯飞开放平台 | 阿里云 | 音色自然，支持情感 |
| 文字识别(OCR) | 阿里云OCR | 百度OCR | 准确率高，药品识别定制 |
| 自然语言理解(NLU) | 百度UNIT | Rasa | 意图识别、槽位填充 |
| 大语言模型(LLM) | 通义千问 | 文心一言 | 对话生成、智能问答 |
| 人脸/形象生成 | 阿里云视觉智能 | 自研 | 子女照片生成动态形象 |

### 2.4 DevOps技术栈

| 技术领域 | 技术选型 | 说明 |
|:--------|:--------|:----|
| 容器化 | Docker | 应用容器化部署 |
| 容器编排 | Kubernetes | 生产环境容器编排 |
| CI/CD | GitHub Actions / Jenkins | 持续集成与部署 |
| 监控告警 | Prometheus + Grafana | 系统监控可视化 |
| 日志管理 | ELK Stack | 日志收集与分析 |
| APM | SkyWalking | 分布式链路追踪 |

## 3. 系统架构图

### 3.1 整体系统架构

```
                              ┌─────────────────┐
                              │   CDN (静态资源)  │
                              └────────┬────────┘
                                       │
┌──────────────┐              ┌────────▼────────┐              ┌──────────────┐
│              │              │                 │              │              │
│   老年端APP   │◄────────────►│    API Gateway  │◄────────────►│  子女端APP    │
│   (Android)  │              │   (Kong/Nginx)  │              │  (Flutter)   │
│              │              │                 │              │              │
└──────────────┘              └────────┬────────┘              └──────────────┘
                                       │
                    ┌──────────────────┼──────────────────┐
                    │                  │                  │
           ┌───────▼───────┐  ┌───────▼───────┐  ┌───────▼───────┐
           │   用户服务     │  │   健康服务     │  │   消息服务     │
           │ user-service  │  │health-service │  │  msg-service  │
           └───────┬───────┘  └───────┬───────┘  └───────┬───────┘
                   │                  │                  │
           ┌───────▼───────┐  ┌───────▼───────┐  ┌───────▼───────┐
           │   安全服务     │  │    AI服务     │  │   提醒服务     │
           │security-service│ │  ai-service   │  │reminder-service│
           └───────┬───────┘  └───────┬───────┘  └───────┬───────┘
                   │                  │                  │
                   └──────────────────┼──────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    │                 │                 │
              ┌─────▼─────┐     ┌─────▼─────┐     ┌─────▼─────┐
              │   MySQL   │     │   Redis   │     │  RabbitMQ │
              │  (主从)    │     │  (集群)   │     │   (集群)   │
              └───────────┘     └───────────┘     └───────────┘
```

### 3.2 数据流架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           数据流向图                                      │
└─────────────────────────────────────────────────────────────────────────┘

【药品识别流程】
老年端 ──拍照──► 图片压缩 ──上传──► OSS ──触发──► AI服务 ──调用──► 阿里云OCR
                                                    │
                                          ◄─────识别结果
                                                    │
                                          ──存储──► MySQL
                                                    │
                                          ──推送──► 子女端

【语音交互流程】
老年端 ──录音──► 流式上传 ──► 讯飞ASR ──文本──► NLU意图识别 ──► 业务逻辑处理
                                                                    │
老年端 ◄──播放── TTS合成 ◄──文本── 回复生成 ◄─────────────────────────┘

【实时通信流程】
老年端 ◄──── WebSocket ────► 消息服务 ◄──── WebSocket ────► 子女端
                               │
                               ▼
                           RabbitMQ (消息持久化)
```

## 4. 部署架构

### 4.1 云服务架构（阿里云）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              VPC 私有网络                                 │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                         公网区域                                   │    │
│  │   ┌───────────┐    ┌───────────┐    ┌───────────┐               │    │
│  │   │    SLB    │    │    WAF    │    │    CDN    │               │    │
│  │   │  负载均衡  │    │  Web防火墙 │    │  内容分发  │               │    │
│  │   └─────┬─────┘    └─────┬─────┘    └───────────┘               │    │
│  └─────────┼────────────────┼───────────────────────────────────────┘    │
│            │                │                                            │
│  ┌─────────▼────────────────▼───────────────────────────────────────┐    │
│  │                        应用区域                                    │    │
│  │   ┌─────────────────────────────────────────────────────┐        │    │
│  │   │               Kubernetes Cluster                     │        │    │
│  │   │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │        │    │
│  │   │  │ Gateway │ │  User   │ │ Health  │ │   AI    │   │        │    │
│  │   │  │   Pod   │ │  Pods   │ │  Pods   │ │  Pods   │   │        │    │
│  │   │  └─────────┘ └─────────┘ └─────────┘ └─────────┘   │        │    │
│  │   │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │        │    │
│  │   │  │   Msg   │ │Security │ │Reminder │ │  File   │   │        │    │
│  │   │  │  Pods   │ │  Pods   │ │  Pods   │ │  Pods   │   │        │    │
│  │   │  └─────────┘ └─────────┘ └─────────┘ └─────────┘   │        │    │
│  │   └─────────────────────────────────────────────────────┘        │    │
│  └──────────────────────────────────────────────────────────────────┘    │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐    │
│  │                        数据区域                                    │    │
│  │   ┌───────────┐    ┌───────────┐    ┌───────────┐               │    │
│  │   │   RDS     │    │   Redis   │    │    OSS    │               │    │
│  │   │  MySQL    │    │   集群    │    │  对象存储  │               │    │
│  │   │  主备架构  │    │           │    │           │               │    │
│  │   └───────────┘    └───────────┘    └───────────┘               │    │
│  └──────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 MVP阶段简化部署

```
┌─────────────────────────────────────────┐
│            单机/小集群部署               │
│                                         │
│   ┌─────────────────────────────────┐   │
│   │         Docker Compose          │   │
│   │  ┌─────────┐  ┌─────────┐      │   │
│   │  │  Nginx  │  │  Redis  │      │   │
│   │  └─────────┘  └─────────┘      │   │
│   │  ┌─────────┐  ┌─────────┐      │   │
│   │  │ Backend │  │  MySQL  │      │   │
│   │  │(单体应用)│  │         │      │   │
│   │  └─────────┘  └─────────┘      │   │
│   └─────────────────────────────────┘   │
│                                         │
│   云服务器: 2核4G × 1台                  │
│   数据库: 云数据库 RDS 基础版             │
│   存储: OSS 标准存储                     │
└─────────────────────────────────────────┘
```

## 5. 安全架构

### 5.1 安全分层设计

```
┌─────────────────────────────────────────────────────────────────┐
│                         安全架构分层                              │
├─────────────────────────────────────────────────────────────────┤
│  应用安全层                                                      │
│  ├── 身份认证: JWT Token + 刷新Token机制                         │
│  ├── 权限控制: RBAC 角色权限模型                                  │
│  ├── 输入校验: 参数校验 + SQL注入防护 + XSS防护                   │
│  └── 敏感操作: 二次确认 + 操作日志                                │
├─────────────────────────────────────────────────────────────────┤
│  传输安全层                                                      │
│  ├── HTTPS: TLS 1.3 全站加密                                    │
│  ├── 数据加密: AES-256 敏感数据加密传输                           │
│  └── 签名验证: API请求签名防篡改                                  │
├─────────────────────────────────────────────────────────────────┤
│  数据安全层                                                      │
│  ├── 存储加密: 数据库透明加密                                     │
│  ├── 隐私保护: 手机号/身份证脱敏存储                              │
│  ├── 数据隔离: 家庭数据逻辑隔离                                   │
│  └── 备份策略: 每日增量 + 每周全量备份                            │
├─────────────────────────────────────────────────────────────────┤
│  网络安全层                                                      │
│  ├── WAF防护: SQL注入/XSS/CC攻击防护                             │
│  ├── DDoS防护: 云厂商DDoS高防                                    │
│  ├── 访问控制: IP白名单 + 频率限制                                │
│  └── 内网隔离: 应用与数据库内网通信                               │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 隐私保护措施

| 数据类型 | 保护措施 |
|:--------|:--------|
| 用户手机号 | 脱敏显示（138****8888），AES加密存储 |
| 语音数据 | 流式识别，不存储原始录音 |
| 图片数据 | 处理后7天自动清理，用户可手动删除 |
| 位置信息 | 仅在用户授权后采集，模糊化处理 |
| 健康数据 | 端到端加密，仅家庭成员可见 |

## 6. 性能要求

### 6.1 性能指标

| 指标类型 | 指标项 | 目标值 | 说明 |
|:--------|:------|:------|:----|
| 响应时间 | API平均响应 | <200ms | P95 < 500ms |
| 响应时间 | 语音识别响应 | <500ms | 首字响应时间 |
| 响应时间 | OCR识别响应 | <2s | 复杂图片场景 |
| 响应时间 | 推送延迟 | <1s | 消息从发送到接收 |
| 吞吐量 | API QPS | >1000 | 单实例 |
| 吞吐量 | WebSocket连接 | >10000 | 单机并发连接 |
| 可用性 | 系统可用性 | 99.9% | 月度SLA |
| 可用性 | 核心功能可用性 | 99.99% | 紧急呼叫等 |

### 6.2 性能优化策略

| 优化维度 | 策略 |
|:--------|:----|
| 缓存优化 | 热点数据Redis缓存，用户Session缓存 |
| 数据库优化 | 读写分离，索引优化，慢查询监控 |
| 接口优化 | 接口合并，数据压缩，分页加载 |
| CDN加速 | 静态资源CDN，就近访问 |
| 异步处理 | 消息队列异步处理非核心流程 |
| 客户端优化 | 图片压缩，本地缓存，预加载 |

### 6.3 容量规划（MVP阶段）

| 资源类型 | 配置 | 数量 | 预估成本/月 |
|:--------|:----|:----|:----------|
| 云服务器 | 2核4G | 1台 | ¥200 |
| 云数据库 | MySQL 1核2G | 1实例 | ¥100 |
| 云缓存 | Redis 1G | 1实例 | ¥100 |
| 对象存储 | OSS 100G | - | ¥50 |
| CDN流量 | 100G/月 | - | ¥50 |
| AI服务 | OCR/语音 | - | ¥200 |
| **合计** | - | - | **¥700** |
