# 银龄守候·双模交互版 - AI服务接口文档

> 文档版本：v1.0  
> 更新日期：2025年12月21日  
> 文档状态：待完善

---

## 目录

- [1. 接口概述](#1-接口概述)
- [2. 语音识别接口](#2-语音识别接口)
- [3. 语音合成接口](#3-语音合成接口)
- [4. OCR文字识别接口](#4-ocr文字识别接口)
- [5. 意图理解接口](#5-意图理解接口)
- [6. 对话管理接口](#6-对话管理接口)
- [7. 错误码定义](#7-错误码定义)

---

## 1. 接口概述

### 1.1 基础信息

- **服务名称**：AI服务 (ai-service)
- **基础路径**：`/api/v1/ai`
- **认证方式**：JWT Bearer Token
- **数据格式**：JSON / Multipart
- **字符编码**：UTF-8

### 1.2 AI能力模块

| 模块 | 说明 | 第三方服务 | 成本 |
|:----|:----|:----------|:-----|
| 语音识别(ASR) | 语音转文字 | 讯飞语音 | ¥0.02/次 |
| 语音合成(TTS) | 文字转语音 | 讯飞语音 | ¥0.015/次 |
| OCR识别 | 图像文字识别 | 阿里云OCR | ¥0.03/次 |
| 意图理解(NLU) | 自然语言理解 | 百度UNIT | ¥0.01/次 |
| 对话管理 | 多轮对话 | 通义千问 | ¥0.002/token |

### 1.3 AI服务架构

```
┌─────────────────────────────────────────────────────────────┐
│                      AI服务架构                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  客户端APP                                                   │
│      │                                                      │
│      ├──HTTP──┐                                             │
│      │        ▼                                             │
│      │    ┌─────────────┐                                   │
│      │    │  API网关    │                                   │
│      │    └──────┬──────┘                                   │
│      │           │                                          │
│      │           ▼                                          │
│      │    ┌─────────────┐                                   │
│      │    │  AI服务     │                                   │
│      │    │ - 请求路由  │                                   │
│      │    │ - 结果缓存  │                                   │
│      │    │ - 成本统计  │                                   │
│      │    └──────┬──────┘                                   │
│      │           │                                          │
│      │           ├────────────┬─────────────┬──────────────┤│
│      │           ▼            ▼             ▼              ││
│      │    ┌──────────┐  ┌──────────┐  ┌──────────┐       ││
│      │    │ 讯飞ASR  │  │ 阿里OCR  │  │ 百度UNIT │       ││
│      │    └──────────┘  └──────────┘  └──────────┘       ││
│      │           │            │             │              ││
│      │           ▼            ▼             ▼              ││
│      │    ┌─────────────────────────────────────┐         ││
│      │    │         第三方AI服务                 │         ││
│      │    └─────────────────────────────────────┘         ││
│      │                                                      │
│      └──────────────────────────────────────────────────────┘
│                                                             │
│  数据层：                                                    │
│  ├─ Redis：结果缓存、请求限流                                │
│  ├─ MySQL：调用日志、成本统计                                │
│  └─ OSS：音频/图片文件存储                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.4 服务特性

**1. 智能缓存**
- ASR结果缓存24小时
- OCR结果缓存7天
- 相同输入直接返回缓存

**2. 降级策略**
- 主服务失败自动切换备用服务
- 本地模型作为最终降级方案

**3. 成本控制**
- 请求频率限制
- 每日成本预警
- 异常调用监控

**4. 性能优化**
- 批量请求合并
- 异步处理
- 流式返回

### 1.5 请求限流

| 接口类型 | 限流规则 | 说明 |
|:--------|:---------|:-----|
| ASR | 100次/分钟/用户 | 语音识别 |
| TTS | 100次/分钟/用户 | 语音合成 |
| OCR | 50次/分钟/用户 | 图像识别 |
| NLU | 200次/分钟/用户 | 意图理解 |
| 对话 | 20次/分钟/用户 | 对话管理 |

## 2. 语音识别接口

### 2.1 实时语音识别（流式）

**接口地址**：`WebSocket wss://api.yinlingshouhou.com/ws/ai/asr`

**连接参数**：

| 参数 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| token | String | ✔ | JWT访问令牌 |
| language | String | ✘ | 语言：zh-CN/en-US，默认zh-CN |
| sampleRate | Integer | ✘ | 采样率：8000/16000，默认16000 |

**连接示例**：
```
wss://api.yinlingshouhou.com/ws/ai/asr?token={token}&language=zh-CN&sampleRate=16000
```

**发送音频数据**：

```json
{
  "type": "AUDIO_DATA",
  "data": "base64_encoded_audio_chunk",
  "seq": 1,
  "isEnd": false
}
```

**识别结果（实时返回）**：

```json
{
  "type": "ASR_RESULT",
  "result": {
    "text": "今天天气怎么样",
    "isFinal": false,
    "confidence": 0.85,
    "seq": 1
  }
}
```

**最终结果**：

```json
{
  "type": "ASR_RESULT",
  "result": {
    "text": "今天天气怎么样？",
    "isFinal": true,
    "confidence": 0.92,
    "duration": 2.5,
    "wordList": [
      {
        "word": "今天",
        "startTime": 0.0,
        "endTime": 0.5
      },
      {
        "word": "天气",
        "startTime": 0.5,
        "endTime": 1.0
      },
      {
        "word": "怎么样",
        "startTime": 1.0,
        "endTime": 2.0
      }
    ]
  }
}
```

### 2.2 语音文件识别（非流式）

**接口地址**：`POST /api/v1/ai/asr/file`

**请求头**：
```
Authorization: Bearer {accessToken}
Content-Type: multipart/form-data
```

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| audioFile | File | ✔ | 音频文件（MP3/WAV/AMR，≤10MB） |
| language | String | ✘ | 语言代码，默认zh-CN |
| enablePunctuation | Boolean | ✘ | 是否添加标点，默认true |
| enableNumberConvert | Boolean | ✘ | 数字转换，默认true |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "asr_1704067200_001",
    "text": "爸，今天记得吃药哦。",
    "confidence": 0.95,
    "duration": 3.2,
    "language": "zh-CN",
    "wordList": [
      {
        "word": "爸",
        "startTime": 0.0,
        "endTime": 0.3,
        "confidence": 0.98
      },
      {
        "word": "今天",
        "startTime": 0.3,
        "endTime": 0.8,
        "confidence": 0.95
      },
      {
        "word": "记得",
        "startTime": 0.8,
        "endTime": 1.3,
        "confidence": 0.92
      },
      {
        "word": "吃药",
        "startTime": 1.3,
        "endTime": 2.0,
        "confidence": 0.96
      },
      {
        "word": "哦",
        "startTime": 2.0,
        "endTime": 3.2,
        "confidence": 0.94
      }
    ],
    "cached": false,
    "processingTime": 850
  },
  "timestamp": 1704067200000
}
```

### 2.3 方言识别

**接口地址**：`POST /api/v1/ai/asr/dialect`

**支持方言**：
- `sichuan`：四川话
- `cantonese`：粤语
- `shanghai`：上海话
- `northeast`：东北话
- `henan`：河南话

**请求参数**：

```json
{
  "audioFile": "base64_encoded_audio",
  "dialect": "sichuan"
}
```

**响应格式**：同2.2文件识别接口

### 2.4 语音VAD检测

**接口地址**：`POST /api/v1/ai/asr/vad`

**功能说明**：检测音频中的有效语音片段，去除静音部分

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| audioFile | File | ✔ | 音频文件 |
| sensitivity | String | ✘ | 灵敏度：LOW/MEDIUM/HIGH，默认MEDIUM |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalDuration": 10.5,
    "speechDuration": 6.2,
    "silenceDuration": 4.3,
    "segments": [
      {
        "startTime": 0.5,
        "endTime": 3.2,
        "duration": 2.7,
        "type": "SPEECH"
      },
      {
        "startTime": 3.2,
        "endTime": 4.8,
        "type": "SILENCE"
      },
      {
        "startTime": 4.8,
        "endTime": 8.3,
        "duration": 3.5,
        "type": "SPEECH"
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 2.5 语音质量检测

**接口地址**：`POST /api/v1/ai/asr/quality`

**功能说明**：检测音频质量，包括噪音、音量、清晰度等

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| audioFile | File | ✔ | 音频文件 |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "overallScore": 85,
    "quality": "GOOD",
    "metrics": {
      "snr": 25.5,
      "volume": -12.3,
      "clarity": 0.88,
      "noiseLevel": "LOW"
    },
    "issues": [
      {
        "type": "BACKGROUND_NOISE",
        "severity": "LOW",
        "description": "轻微背景噪音"
      }
    ],
    "recommendations": [
      "建议在安静环境下录音",
      "可适当提高音量"
    ]
  },
  "timestamp": 1704067200000
}
```

**质量等级**：
- `EXCELLENT`（90-100分）：优秀
- `GOOD`（80-89分）：良好
- `FAIR`（70-79分）：一般
- `POOR`（60-69分）：较差
- `VERY_POOR`（<60分）：很差

### 2.6 批量识别

**接口地址**：`POST /api/v1/ai/asr/batch`

**请求参数**：

```json
{
  "audioUrls": [
    "https://oss.example.com/audio1.mp3",
    "https://oss.example.com/audio2.mp3"
  ],
  "language": "zh-CN",
  "callbackUrl": "https://yourserver.com/callback"
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "batchId": "batch_1704067200_001",
    "totalCount": 2,
    "status": "PROCESSING",
    "estimatedTime": 30
  },
  "timestamp": 1704067200000
}
```

**批量结果查询**：`GET /api/v1/ai/asr/batch/{batchId}`

**回调通知**：

```json
{
  "batchId": "batch_1704067200_001",
  "status": "COMPLETED",
  "results": [
    {
      "audioUrl": "https://oss.example.com/audio1.mp3",
      "text": "识别结果1",
      "confidence": 0.95
    },
    {
      "audioUrl": "https://oss.example.com/audio2.mp3",
      "text": "识别结果2",
      "confidence": 0.92
    }
  ]
}
```

## 3. 语音合成接口

### 3.1 文字转语音

**接口地址**：`POST /api/v1/ai/tts/synthesize`

**请求参数**：

```json
{
  "text": "今天天气很好，记得出去散散步。",
  "voiceName": "xiaoyan",
  "speed": 50,
  "volume": 50,
  "pitch": 50,
  "audioFormat": "mp3",
  "sampleRate": 16000
}
```

**字段说明**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| text | String | ✔ | 要合成的文本（≤1000字） |
| voiceName | String | ✘ | 发音人，默认xiaoyan |
| speed | Integer | ✘ | 语速：0-100，默认50 |
| volume | Integer | ✘ | 音量：0-100，默认50 |
| pitch | Integer | ✘ | 音调：0-100，默认50 |
| audioFormat | String | ✘ | 音频格式：mp3/wav，默认mp3 |
| sampleRate | Integer | ✘ | 采样率：8000/16000，默认16000 |

**发音人列表**：

| voiceName | 性别 | 风格 | 适用场景 |
|:----------|:-----|:-----|:---------|
| xiaoyan | 女 | 温柔亲切 | 老年端默认 |
| xiaoyu | 女 | 活泼可爱 | 提醒通知 |
| xiaofeng | 男 | 沉稳磁性 | 重要播报 |
| xiaomei | 女 | 甜美柔和 | 睡前故事 |
| xiaoqian | 女 | 知性优雅 | 新闻播报 |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "tts_1704067200_001",
    "audioUrl": "https://oss.example.com/tts/20250101_001.mp3",
    "audioData": "base64_encoded_audio_data",
    "duration": 5.2,
    "audioFormat": "mp3",
    "sampleRate": 16000,
    "size": 83200,
    "text": "今天天气很好，记得出去散散步。",
    "cached": false,
    "processingTime": 320
  },
  "timestamp": 1704067200000
}
```

### 3.2 流式语音合成

**接口地址**：`WebSocket wss://api.yinlingshouhou.com/ws/ai/tts`

**连接参数**：
```
wss://api.yinlingshouhou.com/ws/ai/tts?token={token}&voiceName=xiaoyan
```

**发送文本**：

```json
{
  "type": "TEXT",
  "text": "今天天气很好",
  "speed": 50,
  "volume": 50
}
```

**接收音频流**：

```json
{
  "type": "AUDIO_CHUNK",
  "data": "base64_encoded_audio_chunk",
  "seq": 1,
  "isEnd": false
}
```

**合成完成**：

```json
{
  "type": "COMPLETE",
  "duration": 3.5,
  "totalChunks": 12
}
```

### 3.3 SSML语音合成

**接口地址**：`POST /api/v1/ai/tts/ssml`

**功能说明**：使用SSML标记语言控制语音合成细节

**请求参数**：

```json
{
  "ssml": "<speak>今天<break time='500ms'/>天气很好，<emphasis level='strong'>记得</emphasis>出去散步。</speak>",
  "voiceName": "xiaoyan",
  "audioFormat": "mp3"
}
```

**SSML标签支持**：

| 标签 | 说明 | 示例 |
|:----|:----|:-----|
| `<break>` | 停顿 | `<break time='500ms'/>` |
| `<emphasis>` | 强调 | `<emphasis level='strong'>重要</emphasis>` |
| `<prosody>` | 韵律控制 | `<prosody rate='fast'>快速</prosody>` |
| `<say-as>` | 发音方式 | `<say-as interpret-as='telephone'>13800138000</say-as>` |

**响应格式**：同3.1文字转语音接口

### 3.4 批量合成

**接口地址**：`POST /api/v1/ai/tts/batch`

**请求参数**：

```json
{
  "texts": [
    "第一段文本内容",
    "第二段文本内容",
    "第三段文本内容"
  ],
  "voiceName": "xiaoyan",
  "mergeAudio": true,
  "callbackUrl": "https://yourserver.com/callback"
}
```

**字段说明**：
- `mergeAudio`：是否合并为一个音频文件
- `callbackUrl`：异步回调地址

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "batchId": "tts_batch_1704067200_001",
    "totalCount": 3,
    "status": "PROCESSING",
    "estimatedTime": 15
  },
  "timestamp": 1704067200000
}
```

**批量结果查询**：`GET /api/v1/ai/tts/batch/{batchId}`

### 3.5 语音情感控制

**接口地址**：`POST /api/v1/ai/tts/emotion`

**请求参数**：

```json
{
  "text": "今天心情真好！",
  "emotion": "HAPPY",
  "emotionIntensity": 80,
  "voiceName": "xiaoyan"
}
```

**情感类型**：

| emotion | 中文 | 说明 |
|:--------|:-----|:-----|
| NEUTRAL | 中性 | 平静叙述 |
| HAPPY | 快乐 | 欢快愉悦 |
| SAD | 悲伤 | 低沉伤感 |
| ANGRY | 愤怒 | 严厉急促 |
| GENTLE | 温柔 | 柔和亲切 |
| EXCITED | 兴奋 | 激动高昂 |

**情感强度**：0-100，数值越大情感越明显

**响应格式**：同3.1文字转语音接口

### 3.6 数字智能播报

**接口地址**：`POST /api/v1/ai/tts/number`

**功能说明**：智能识别并播报数字、日期、时间、电话号码等

**请求参数**：

```json
{
  "text": "您的血压是120/80mmHg，电话号码是13800138000，时间是2025年1月1日8:30",
  "voiceName": "xiaoyan"
}
```

**播报效果**：
- 血压：一百二十 / 八十
- 电话：幺三八 零零 幺三八 零零零
- 时间：二零二五年一月一日 八点三十分

**响应格式**：同3.1文字转语音接口

### 3.7 多角色对话合成

**接口地址**：`POST /api/v1/ai/tts/dialogue`

**请求参数**：

```json
{
  "dialogues": [
    {
      "speaker": "张小明",
      "voiceName": "xiaofeng",
      "text": "爸，今天感觉怎么样？"
    },
    {
      "speaker": "张大爷",
      "voiceName": "xiaoyan",
      "text": "挺好的，今天还出去散步了。"
    },
    {
      "speaker": "张小明",
      "voiceName": "xiaofeng",
      "text": "那就好，记得按时吃药。"
    }
  ],
  "pauseBetweenSpeakers": 800
}
```

**字段说明**：
- `pauseBetweenSpeakers`：说话人之间停顿时长（毫秒）

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "tts_dialogue_1704067200_001",
    "audioUrl": "https://oss.example.com/tts/dialogue_001.mp3",
    "duration": 12.5,
    "speakers": [
      {
        "speaker": "张小明",
        "startTime": 0.0,
        "endTime": 3.2
      },
      {
        "speaker": "张大爷",
        "startTime": 4.0,
        "endTime": 7.5
      },
      {
        "speaker": "张小明",
        "startTime": 8.3,
        "endTime": 12.5
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 3.8 获取发音人列表

**接口地址**：`GET /api/v1/ai/tts/voices`

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| gender | String | ✘ | 性别：MALE/FEMALE |
| language | String | ✘ | 语言：zh-CN/en-US |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "voices": [
      {
        "voiceName": "xiaoyan",
        "displayName": "小燕",
        "gender": "FEMALE",
        "language": "zh-CN",
        "style": "温柔亲切",
        "description": "适合老年端默认发音人",
        "sampleAudioUrl": "https://oss.example.com/samples/xiaoyan.mp3",
        "isPremium": false
      },
      {
        "voiceName": "xiaofeng",
        "displayName": "小峰",
        "gender": "MALE",
        "language": "zh-CN",
        "style": "沉稳磁性",
        "description": "适合重要播报",
        "sampleAudioUrl": "https://oss.example.com/samples/xiaofeng.mp3",
        "isPremium": false
      }
    ]
  },
  "timestamp": 1704067200000
}
```

## 4. OCR文字识别接口

### 4.1 通用文字识别

**接口地址**：`POST /api/v1/ai/ocr/general`

**请求头**：
```
Authorization: Bearer {accessToken}
Content-Type: multipart/form-data
```

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| image | File | ✔ | 图片文件（JPG/PNG，≤10MB） |
| language | String | ✘ | 语言：zh-CN/en-US，默认zh-CN |
| detectRotate | Boolean | ✘ | 是否检测旋转，默认true |
| returnLocation | Boolean | ✘ | 是否返回位置信息，默认false |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_1704067200_001",
    "text": "阿司匹林肠溶片\n100mg×30片\n批准文号：国药准字H20050052",
    "confidence": 0.98,
    "textBlocks": [
      {
        "text": "阿司匹林肠溶片",
        "confidence": 0.99,
        "location": {
          "left": 50,
          "top": 30,
          "width": 200,
          "height": 40
        }
      },
      {
        "text": "100mg×30片",
        "confidence": 0.98,
        "location": {
          "left": 50,
          "top": 80,
          "width": 150,
          "height": 30
        }
      },
      {
        "text": "批准文号：国药准字H20050052",
        "confidence": 0.97,
        "location": {
          "left": 50,
          "top": 120,
          "width": 300,
          "height": 25
        }
      }
    ],
    "imageInfo": {
      "width": 1080,
      "height": 1920,
      "rotateAngle": 0,
      "format": "JPEG"
    },
    "cached": false,
    "processingTime": 650
  },
  "timestamp": 1704067200000
}
```

### 4.2 药品识别

**接口地址**：`POST /api/v1/ai/ocr/medicine`

**功能说明**：专门识别药品包装和说明书，提取关键信息

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| image | File | ✔ | 药品图片 |
| scene | String | ✘ | 场景：PACKAGE/INSTRUCTIONS，默认PACKAGE |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_medicine_1704067200_001",
    "medicineInfo": {
      "name": "阿司匹林肠溶片",
      "manufacturer": "拜耳医药保健有限公司",
      "specification": "100mg×30片",
      "approvalNumber": "国药准字H20050052",
      "expiryDate": "2026-12-31",
      "batchNumber": "20230101",
      "confidence": {
        "name": 0.99,
        "manufacturer": 0.95,
        "specification": 0.98,
        "approvalNumber": 0.97
      }
    },
    "rawText": "阿司匹林肠溶片\n拜耳医药保健有限公司\n规格：100mg×30片\n批准文号：国药准字H20050052\n有效期至：2026-12-31\n批号：20230101",
    "imageQuality": {
      "score": 92,
      "isBlurry": false,
      "brightness": "NORMAL",
      "issues": []
    }
  },
  "timestamp": 1704067200000
}
```

### 4.3 身份证识别

**接口地址**：`POST /api/v1/ai/ocr/idcard`

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| image | File | ✔ | 身份证图片 |
| side | String | ✔ | 正反面：FRONT/BACK |

**响应示例（正面）**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_idcard_1704067200_001",
    "side": "FRONT",
    "idCardInfo": {
      "name": "张三",
      "gender": "男",
      "nation": "汉",
      "birthDate": "1955-06-15",
      "address": "北京市朝阳区xxx",
      "idNumber": "110101195506151234",
      "confidence": {
        "name": 0.99,
        "idNumber": 0.98,
        "birthDate": 0.97
      }
    },
    "faceLocation": {
      "left": 150,
      "top": 200,
      "width": 200,
      "height": 250
    }
  },
  "timestamp": 1704067200000
}
```

**响应示例（背面）**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_idcard_1704067200_002",
    "side": "BACK",
    "idCardInfo": {
      "issuingAuthority": "北京市公安局朝阳分局",
      "validPeriod": "2015.06.15-2025.06.15",
      "confidence": {
        "issuingAuthority": 0.96,
        "validPeriod": 0.98
      }
    }
  },
  "timestamp": 1704067200000
}
```

### 4.4 银行卡识别

**接口地址**：`POST /api/v1/ai/ocr/bankcard`

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| image | File | ✔ | 银行卡图片 |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_bankcard_1704067200_001",
    "bankCardInfo": {
      "cardNumber": "6222 0000 0000 0000",
      "bankName": "中国工商银行",
      "cardType": "DEBIT",
      "validThru": "12/28",
      "confidence": {
        "cardNumber": 0.99,
        "bankName": 0.95
      }
    }
  },
  "timestamp": 1704067200000
}
```

**卡片类型**：
- `DEBIT`：借记卡
- `CREDIT`：信用卡
- `PREPAID`：预付卡

### 4.5 表格识别

**接口地址**：`POST /api/v1/ai/ocr/table`

**功能说明**：识别图片中的表格，返回结构化数据

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| image | File | ✔ | 表格图片 |
| returnFormat | String | ✘ | 返回格式：JSON/EXCEL/CSV，默认JSON |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_table_1704067200_001",
    "tableCount": 1,
    "tables": [
      {
        "tableId": 1,
        "rowCount": 4,
        "columnCount": 3,
        "cells": [
          {
            "row": 0,
            "column": 0,
            "text": "日期",
            "rowSpan": 1,
            "colSpan": 1
          },
          {
            "row": 0,
            "column": 1,
            "text": "血压",
            "rowSpan": 1,
            "colSpan": 1
          },
          {
            "row": 0,
            "column": 2,
            "text": "血糖",
            "rowSpan": 1,
            "colSpan": 1
          },
          {
            "row": 1,
            "column": 0,
            "text": "2025-01-01",
            "rowSpan": 1,
            "colSpan": 1
          },
          {
            "row": 1,
            "column": 1,
            "text": "120/80",
            "rowSpan": 1,
            "colSpan": 1
          },
          {
            "row": 1,
            "column": 2,
            "text": "5.6",
            "rowSpan": 1,
            "colSpan": 1
          }
        ],
        "excelUrl": "https://oss.example.com/ocr/table_001.xlsx"
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 4.6 手写文字识别

**接口地址**：`POST /api/v1/ai/ocr/handwriting`

**功能说明**：识别手写文字

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| image | File | ✔ | 手写文字图片 |
| language | String | ✘ | 语言：zh-CN/en-US |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_handwriting_1704067200_001",
    "text": "今天天气很好\n记得出去散步",
    "confidence": 0.85,
    "lines": [
      {
        "text": "今天天气很好",
        "confidence": 0.88,
        "location": {
          "left": 50,
          "top": 100,
          "width": 300,
          "height": 40
        }
      },
      {
        "text": "记得出去散步",
        "confidence": 0.82,
        "location": {
          "left": 50,
          "top": 150,
          "width": 280,
          "height": 40
        }
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 4.7 二维码/条形码识别

**接口地址**：`POST /api/v1/ai/ocr/barcode`

**请求参数**：

| 字段 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| image | File | ✔ | 图片文件 |
| type | String | ✘ | 类型：QR_CODE/BAR_CODE/AUTO，默认AUTO |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "ocr_barcode_1704067200_001",
    "codes": [
      {
        "type": "QR_CODE",
        "content": "https://www.example.com",
        "location": {
          "left": 100,
          "top": 100,
          "width": 200,
          "height": 200
        }
      },
      {
        "type": "BAR_CODE",
        "content": "6901234567890",
        "format": "EAN-13",
        "location": {
          "left": 50,
          "top": 350,
          "width": 300,
          "height": 80
        }
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 4.8 批量OCR识别

**接口地址**：`POST /api/v1/ai/ocr/batch`

**请求参数**：

```json
{
  "imageUrls": [
    "https://oss.example.com/img1.jpg",
    "https://oss.example.com/img2.jpg"
  ],
  "ocrType": "GENERAL",
  "callbackUrl": "https://yourserver.com/callback"
}
```

**OCR类型**：
- `GENERAL`：通用识别
- `MEDICINE`：药品识别
- `IDCARD`：身份证识别
- `BANKCARD`：银行卡识别
- `TABLE`：表格识别
- `HANDWRITING`：手写识别

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "batchId": "ocr_batch_1704067200_001",
    "totalCount": 2,
    "status": "PROCESSING",
    "estimatedTime": 20
  },
  "timestamp": 1704067200000
}
```

**批量结果查询**：`GET /api/v1/ai/ocr/batch/{batchId}`

## 5. 意图理解接口

### 5.1 意图识别

**接口地址**：`POST /api/v1/ai/nlu/intent`

**功能说明**：识别用户输入的意图和实体

**请求参数**：

```json
{
  "text": "帮我设置明天早上8点的吃药提醒",
  "userId": "user_123",
  "sessionId": "session_abc",
  "context": {
    "lastIntent": "QUERY_MEDICATION",
    "conversationTurn": 2
  }
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "nlu_1704067200_001",
    "intent": {
      "name": "SET_MEDICATION_REMINDER",
      "confidence": 0.95,
      "domain": "HEALTH"
    },
    "slots": [
      {
        "name": "time",
        "value": "2025-01-02 08:00:00",
        "rawValue": "明天早上8点",
        "confidence": 0.92,
        "normalized": true
      },
      {
        "name": "action",
        "value": "吃药",
        "rawValue": "吃药",
        "confidence": 0.98,
        "normalized": false
      }
    ],
    "entities": [
      {
        "type": "DATETIME",
        "value": "2025-01-02 08:00:00",
        "start": 2,
        "end": 10
      },
      {
        "type": "ACTION",
        "value": "吃药",
        "start": 11,
        "end": 13
      }
    ],
    "sentiment": {
      "polarity": "NEUTRAL",
      "score": 0.5
    }
  },
  "timestamp": 1704067200000
}
```

**意图分类（domain:intent）**：

| 领域 | 意图 | 说明 |
|:----|:----|:-----|
| HEALTH | SET_MEDICATION_REMINDER | 设置用药提醒 |
| HEALTH | QUERY_MEDICATION | 查询药品信息 |
| HEALTH | RECORD_HEALTH_DATA | 记录健康数据 |
| HEALTH | QUERY_HEALTH_DATA | 查询健康数据 |
| COMMUNICATION | MAKE_CALL | 发起通话 |
| COMMUNICATION | SEND_MESSAGE | 发送消息 |
| COMMUNICATION | READ_MESSAGE | 阅读消息 |
| ASSISTANT | SET_ALARM | 设置闹钟 |
| ASSISTANT | QUERY_TIME | 查询时间 |
| ASSISTANT | QUERY_WEATHER | 查询天气 |
| EMERGENCY | EMERGENCY_CALL | 紧急求助 |
| CHITCHAT | GREETING | 问候 |
| CHITCHAT | GOODBYE | 告别 |

### 5.2 槽位填充

**接口地址**：`POST /api/v1/ai/nlu/slot-filling`

**功能说明**：对缺失的槽位进行引导式填充

**请求参数**：

```json
{
  "text": "帮我打电话",
  "userId": "user_123",
  "sessionId": "session_abc",
  "intent": "MAKE_CALL",
  "existingSlots": {}
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "nlu_slot_1704067200_001",
    "isComplete": false,
    "missingSlots": ["contactName"],
    "promptQuestion": "请问您要给谁打电话？",
    "suggestions": [
      {
        "contactName": "张三",
        "contactPhone": "13800138001"
      },
      {
        "contactName": "李四",
        "contactPhone": "13800138002"
      }
    ]
  },
  "timestamp": 1704067200000
}
```

**继续填充示例**：

```json
{
  "text": "张三",
  "userId": "user_123",
  "sessionId": "session_abc",
  "intent": "MAKE_CALL",
  "existingSlots": {
    "contactName": "张三"
  }
}
```

**响应（填充完成）**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "nlu_slot_1704067200_002",
    "isComplete": true,
    "filledSlots": {
      "contactName": "张三",
      "contactPhone": "13800138001"
    },
    "action": {
      "type": "MAKE_CALL",
      "parameters": {
        "phone": "13800138001",
        "contactName": "张三"
      }
    }
  },
  "timestamp": 1704067200000
}
```

### 5.3 实体抽取

**接口地址**：`POST /api/v1/ai/nlu/entity`

**功能说明**：从文本中抽取实体信息

**请求参数**：

```json
{
  "text": "我今天血压是135/85，血糖5.8，心率75",
  "entityTypes": ["HEALTH_METRIC"]
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "nlu_entity_1704067200_001",
    "entities": [
      {
        "type": "BLOOD_PRESSURE",
        "value": {
          "systolic": 135,
          "diastolic": 85,
          "unit": "mmHg"
        },
        "rawText": "135/85",
        "start": 5,
        "end": 11,
        "confidence": 0.98
      },
      {
        "type": "BLOOD_SUGAR",
        "value": {
          "value": 5.8,
          "unit": "mmol/L"
        },
        "rawText": "5.8",
        "start": 14,
        "end": 17,
        "confidence": 0.96
      },
      {
        "type": "HEART_RATE",
        "value": {
          "value": 75,
          "unit": "bpm"
        },
        "rawText": "75",
        "start": 20,
        "end": 22,
        "confidence": 0.95
      }
    ]
  },
  "timestamp": 1704067200000
}
```

**支持的实体类型**：

| 类型 | 说明 | 示例 |
|:----|:----|:-----|
| PERSON | 人名 | 张三、李四 |
| DATETIME | 日期时间 | 明天、下周一、2025-01-01 |
| LOCATION | 地点 | 北京、朝阳医院 |
| PHONE_NUMBER | 电话号码 | 13800138000 |
| HEALTH_METRIC | 健康指标 | 血压、血糖、心率 |
| MEDICATION | 药品 | 阿司匹林、降压药 |
| EMOTION | 情绪 | 开心、难过、焦虑 |
| AMOUNT | 数量金额 | 100元、2片 |

### 5.4 情感分析

**接口地址**：`POST /api/v1/ai/nlu/sentiment`

**请求参数**：

```json
{
  "text": "今天感觉很不舒服，头晕晕的，心情也不好",
  "analyzeEmotion": true
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "nlu_sentiment_1704067200_001",
    "sentiment": {
      "polarity": "NEGATIVE",
      "score": -0.75,
      "confidence": 0.92
    },
    "emotions": [
      {
        "type": "UNCOMFORTABLE",
        "intensity": 0.85,
        "keywords": ["不舒服", "头晕"]
      },
      {
        "type": "SAD",
        "intensity": 0.65,
        "keywords": ["心情不好"]
      }
    ],
    "keywords": [
      {
        "word": "不舒服",
        "weight": 0.9,
        "sentiment": "NEGATIVE"
      },
      {
        "word": "头晕",
        "weight": 0.8,
        "sentiment": "NEGATIVE"
      }
    ]
  },
  "timestamp": 1704067200000
}
```

**情感极性**：
- `POSITIVE`：正面情感（score > 0.3）
- `NEUTRAL`：中性情感（-0.3 ≤ score ≤ 0.3）
- `NEGATIVE`：负面情感（score < -0.3）

**情绪类型**：
- `HAPPY`：开心
- `SAD`：难过
- `ANGRY`：生气
- `ANXIOUS`：焦虑
- `UNCOMFORTABLE`：不适
- `LONELY`：孤独

### 5.5 上下文管理

**接口地址**：`POST /api/v1/ai/nlu/context`

**功能说明**：管理对话上下文，支持多轮对话

**保存上下文**：

```json
{
  "userId": "user_123",
  "sessionId": "session_abc",
  "context": {
    "intent": "SET_MEDICATION_REMINDER",
    "slots": {
      "medicationName": "阿司匹林",
      "dosage": "1片"
    },
    "conversationTurn": 2,
    "lastUpdateTime": 1704067200000
  }
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "session_abc",
    "saved": true
  },
  "timestamp": 1704067200000
}
```

**查询上下文**：`GET /api/v1/ai/nlu/context/{sessionId}`

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "session_abc",
    "context": {
      "intent": "SET_MEDICATION_REMINDER",
      "slots": {
        "medicationName": "阿司匹林",
        "dosage": "1片"
      },
      "conversationTurn": 2,
      "lastUpdateTime": 1704067200000
    },
    "isExpired": false,
    "expiresIn": 3600
  },
  "timestamp": 1704067200000
}
```

**清除上下文**：`DELETE /api/v1/ai/nlu/context/{sessionId}`

### 5.6 智能纠错

**接口地址**：`POST /api/v1/ai/nlu/correct`

**功能说明**：纠正用户输入的语音识别错误

**请求参数**：

```json
{
  "text": "帮我设置明天早上八点的吃药体型",
  "domain": "HEALTH"
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "nlu_correct_1704067200_001",
    "correctedText": "帮我设置明天早上八点的吃药提醒",
    "corrections": [
      {
        "original": "体型",
        "corrected": "提醒",
        "start": 14,
        "end": 16,
        "confidence": 0.88
      }
    ],
    "hasCorrectionApplied": true
  },
  "timestamp": 1704067200000
}
```

### 5.7 语义相似度

**接口地址**：`POST /api/v1/ai/nlu/similarity`

**功能说明**：计算两个文本的语义相似度

**请求参数**：

```json
{
  "text1": "帮我设置吃药提醒",
  "text2": "提醒我吃药"
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "requestId": "nlu_similarity_1704067200_001",
    "similarity": 0.92,
    "isSimilar": true,
    "threshold": 0.75
  },
  "timestamp": 1704067200000
}
```

## 6. 对话管理接口

### 6.1 创建对话会话

**接口地址**：`POST /api/v1/ai/chat/session`

**功能说明**：创建新的对话会话

**请求参数**：

```json
{
  "userId": "user_123",
  "chatType": "COMPANION",
  "personality": "GENTLE",
  "context": {
    "userName": "张爷爷",
    "userAge": 75,
    "healthConditions": ["高血压", "糖尿病"]
  }
}
```

**对话类型**：
- `COMPANION`：陪伴聊天
- `ASSISTANT`：任务助手
- `HEALTH_CONSULTATION`：健康咨询
- `EMERGENCY`：紧急对话

**性格设定**：
- `GENTLE`：温柔体贴
- `CHEERFUL`：活泼开朗
- `PROFESSIONAL`：专业严谨
- `HUMOROUS`：幽默风趣

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "chat_session_1704067200_001",
    "userId": "user_123",
    "chatType": "COMPANION",
    "personality": "GENTLE",
    "createTime": 1704067200000,
    "expiresIn": 7200,
    "greetingMessage": "张爷爷您好，我是您的AI陪伴助手小雅，很高兴见到您！有什么可以帮您的吗？"
  },
  "timestamp": 1704067200000
}
```

### 6.2 发送对话消息

**接口地址**：`POST /api/v1/ai/chat/message`

**请求参数**：

```json
{
  "sessionId": "chat_session_1704067200_001",
  "message": {
    "type": "TEXT",
    "content": "今天天气怎么样？",
    "metadata": {
      "inputMethod": "VOICE",
      "location": "北京市朝阳区"
    }
  }
}
```

**消息类型**：
- `TEXT`：文本消息
- `VOICE`：语音消息
- `IMAGE`：图片消息
- `COMMAND`：命令消息

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "messageId": "msg_1704067200_001",
    "sessionId": "chat_session_1704067200_001",
    "response": {
      "type": "TEXT",
      "content": "张爷爷，今天北京天气不错呢！温度15度，多云转晴。建议您出去散散步，呼吸一下新鲜空气，对身体有好处哦！记得穿件外套，早晚温差有点大。",
      "emotion": "CHEERFUL",
      "tts": {
        "audioUrl": "https://oss.example.com/tts/msg_001.mp3",
        "duration": 8500
      }
    },
    "intent": {
      "name": "QUERY_WEATHER",
      "confidence": 0.96
    },
    "suggestedActions": [
      {
        "type": "BUTTON",
        "label": "查看详细天气",
        "action": "OPEN_WEATHER_DETAIL"
      },
      {
        "type": "BUTTON",
        "label": "设置散步提醒",
        "action": "SET_WALK_REMINDER"
      }
    ],
    "timestamp": 1704067200000
  },
  "timestamp": 1704067200000
}
```

### 6.3 流式对话

**接口地址**：WebSocket `wss://api.example.com/api/v1/ai/chat/stream`

**连接参数**：
```
wss://api.example.com/api/v1/ai/chat/stream?sessionId=chat_session_1704067200_001&token={accessToken}
```

**发送消息格式**：

```json
{
  "type": "MESSAGE",
  "content": "给我讲个笑话吧",
  "requestId": "req_001"
}
```

**接收消息格式（流式返回）**：

```json
{
  "type": "STREAM_START",
  "requestId": "req_001",
  "messageId": "msg_1704067200_002"
}
```

```json
{
  "type": "STREAM_CHUNK",
  "requestId": "req_001",
  "messageId": "msg_1704067200_002",
  "content": "好的",
  "isComplete": false
}
```

```json
{
  "type": "STREAM_CHUNK",
  "requestId": "req_001",
  "messageId": "msg_1704067200_002",
  "content": "，张爷爷",
  "isComplete": false
}
```

```json
{
  "type": "STREAM_END",
  "requestId": "req_001",
  "messageId": "msg_1704067200_002",
  "fullContent": "好的，张爷爷，给您讲一个：有一天，小明问爸爸...",
  "metadata": {
    "tokens": 45,
    "duration": 1200
  }
}
```

### 6.4 对话历史

**查询对话历史**：`GET /api/v1/ai/chat/history/{sessionId}`

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|:----|:----|:----|:-----|
| page | Integer | ✘ | 页码，默认1 |
| pageSize | Integer | ✘ | 每页数量，默认20，最大100 |
| startTime | Long | ✘ | 开始时间戳 |
| endTime | Long | ✘ | 结束时间戳 |

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "chat_session_1704067200_001",
    "totalCount": 15,
    "page": 1,
    "pageSize": 20,
    "messages": [
      {
        "messageId": "msg_1704067200_001",
        "direction": "USER",
        "type": "TEXT",
        "content": "今天天气怎么样？",
        "timestamp": 1704067200000
      },
      {
        "messageId": "msg_1704067200_002",
        "direction": "AI",
        "type": "TEXT",
        "content": "张爷爷，今天北京天气不错呢！...",
        "emotion": "CHEERFUL",
        "timestamp": 1704067201000
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 6.5 对话摘要

**接口地址**：`GET /api/v1/ai/chat/summary/{sessionId}`

**功能说明**：生成对话摘要，提取关键信息

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "chat_session_1704067200_001",
    "summary": {
      "mainTopics": ["天气查询", "健康咨询", "用药提醒"],
      "keyPoints": [
        "用户询问了今天的天气情况",
        "用户表示今天血压有些高",
        "AI建议用户按时服药并注意休息"
      ],
      "emotionTrend": "POSITIVE",
      "duration": 1800,
      "messageCount": 15
    },
    "healthInsights": {
      "concerns": ["血压偏高"],
      "suggestions": ["按时服药", "注意休息", "清淡饮食"]
    },
    "actionItems": [
      {
        "type": "MEDICATION_REMINDER",
        "description": "设置明天早上8点用药提醒",
        "status": "COMPLETED"
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 6.6 对话评价

**接口地址**：`POST /api/v1/ai/chat/feedback`

**请求参数**：

```json
{
  "sessionId": "chat_session_1704067200_001",
  "messageId": "msg_1704067200_002",
  "rating": 5,
  "feedback": {
    "isHelpful": true,
    "isAccurate": true,
    "isNatural": true,
    "tags": ["温柔", "耐心", "专业"],
    "comment": "回答得很好，很贴心"
  }
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "feedbackId": "feedback_1704067200_001",
    "submitted": true,
    "thanksMessage": "感谢您的反馈，我会继续努力为您服务！"
  },
  "timestamp": 1704067200000
}
```

### 6.7 多模态对话

**接口地址**：`POST /api/v1/ai/chat/multimodal`

**功能说明**：支持图片+文本的多模态对话

**请求参数**：

```json
{
  "sessionId": "chat_session_1704067200_001",
  "message": {
    "type": "MULTIMODAL",
    "text": "这是什么药？",
    "images": [
      {
        "url": "https://oss.example.com/medicine.jpg",
        "description": "药品包装图片"
      }
    ]
  }
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "messageId": "msg_1704067200_003",
    "response": {
      "type": "TEXT",
      "content": "张爷爷，这是阿司匹林肠溶片，规格是100mg×30片。这是一种抗血小板药物，主要用于预防心脑血管疾病。您需要按医嘱服用，通常是每天1次，每次1片，饭后服用效果更好。",
      "medicineInfo": {
        "name": "阿司匹林肠溶片",
        "manufacturer": "拜耳医药保健有限公司",
        "specification": "100mg×30片",
        "usage": "口服，一次1片，一日1次"
      },
      "relatedActions": [
        {
          "type": "ADD_TO_MEDICATION",
          "label": "添加到我的药品"
        },
        {
          "type": "SET_REMINDER",
          "label": "设置用药提醒"
        }
      ]
    }
  },
  "timestamp": 1704067200000
}
```

### 6.8 对话中断恢复

**接口地址**：`POST /api/v1/ai/chat/resume`

**功能说明**：恢复中断的对话

**请求参数**：

```json
{
  "sessionId": "chat_session_1704067200_001",
  "userId": "user_123"
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "chat_session_1704067200_001",
    "resumed": true,
    "lastContext": {
      "lastMessage": "张爷爷，这是阿司匹林肠溶片...",
      "lastTimestamp": 1704067200000,
      "conversationTurn": 8
    },
    "resumeMessage": "欢迎回来，张爷爷！我们刚才聊到了阿司匹林的服用方法，还有什么想了解的吗？"
  },
  "timestamp": 1704067300000
}
```

### 6.9 关闭对话会话

**接口地址**：`DELETE /api/v1/ai/chat/session/{sessionId}`

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "chat_session_1704067200_001",
    "closed": true,
    "summary": {
      "duration": 1800,
      "messageCount": 15,
      "mainTopics": ["天气查询", "健康咨询", "用药提醒"]
    },
    "farewellMessage": "很高兴和您聊天，张爷爷！祝您身体健康，有需要随时叫我哦！"
  },
  "timestamp": 1704067300000
}
```

## 7. 错误码定义

### 7.1 通用错误码

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 40000 | 请求参数错误 | 检查请求参数格式和必填字段 |
| 40001 | 缺少必填参数 | 补充缺失的必填参数 |
| 40002 | 参数类型错误 | 检查参数类型是否正确 |
| 40003 | 参数值超出范围 | 检查参数值是否在有效范围内 |
| 40100 | 认证失败 | 检查Token是否有效 |
| 40101 | Token已过期 | 刷新Token后重试 |
| 40102 | Token无效 | 重新登录获取Token |
| 40300 | 无权限访问 | 检查用户权限 |
| 40400 | 资源不存在 | 检查资源ID是否正确 |
| 40401 | 会话不存在 | 创建新会话或使用有效会话ID |
| 40900 | 请求频率超限 | 降低请求频率，稍后重试 |
| 40901 | 配额已用尽 | 升级套餐或等待配额刷新 |
| 50000 | 服务器内部错误 | 联系技术支持 |
| 50001 | 第三方服务异常 | 稍后重试，问题持续请联系支持 |
| 50002 | 服务暂时不可用 | 稍后重试 |
| 50300 | 服务超时 | 重试请求或减小请求数据量 |

### 7.2 语音识别错误码

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 41001 | 音频格式不支持 | 使用支持的音频格式（MP3/WAV/AMR） |
| 41002 | 音频文件过大 | 压缩音频文件或分段识别（≤10MB） |
| 41003 | 音频质量过低 | 提高录音质量，减少环境噪音 |
| 41004 | 音频时长超限 | 分段识别（单段≤60秒） |
| 41005 | 音频为空或无效 | 检查音频文件是否有效 |
| 41006 | 未检测到有效语音 | 检查音频是否包含清晰语音内容 |
| 41007 | 语音识别失败 | 提高音频质量后重试 |
| 41008 | 不支持的方言 | 使用支持的方言类型 |
| 41009 | WebSocket连接已断开 | 重新建立WebSocket连接 |
| 41010 | 识别超时 | 缩短音频长度或重试 |

**错误响应示例**：

```json
{
  "code": 41003,
  "message": "音频质量过低",
  "data": {
    "errorCode": "ASR_LOW_QUALITY",
    "details": {
      "snr": 8.5,
      "minSnr": 10,
      "suggestion": "请在安静环境下重新录音"
    }
  },
  "timestamp": 1704067200000
}
```

### 7.3 语音合成错误码

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 42001 | 文本内容为空 | 提供有效的文本内容 |
| 42002 | 文本长度超限 | 分段合成（单段≤1000字） |
| 42003 | 不支持的发音人 | 使用支持的发音人 |
| 42004 | 语速参数无效 | 设置有效的语速值（0.5-2.0） |
| 42005 | 音量参数无效 | 设置有效的音量值（0-100） |
| 42006 | 音调参数无效 | 设置有效的音调值（0.5-2.0） |
| 42007 | SSML格式错误 | 检查SSML标签格式 |
| 42008 | 情感类型不支持 | 使用支持的情感类型 |
| 42009 | 音频生成失败 | 稍后重试 |
| 42010 | 批量任务数超限 | 减少批量任务数（≤100） |

**错误响应示例**：

```json
{
  "code": 42007,
  "message": "SSML格式错误",
  "data": {
    "errorCode": "TTS_SSML_FORMAT_ERROR",
    "details": {
      "line": 3,
      "column": 15,
      "error": "未闭合的<break>标签",
      "suggestion": "检查SSML标签是否正确闭合"
    }
  },
  "timestamp": 1704067200000
}
```

### 7.4 OCR识别错误码

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 43001 | 图片格式不支持 | 使用支持的图片格式（JPG/PNG） |
| 43002 | 图片文件过大 | 压缩图片文件（≤10MB） |
| 43003 | 图片分辨率过低 | 提高图片分辨率（≥300×300） |
| 43004 | 图片为空或无效 | 检查图片文件是否有效 |
| 43005 | 图片过于模糊 | 拍摄清晰的图片 |
| 43006 | 光线不足 | 在光线充足环境下重新拍摄 |
| 43007 | 未检测到文字 | 确保图片包含清晰文字 |
| 43008 | 未检测到身份证 | 确保图片包含完整身份证 |
| 43009 | 未检测到银行卡 | 确保图片包含完整银行卡 |
| 43010 | 未检测到药品信息 | 拍摄药品包装正面 |
| 43011 | 表格结构复杂 | 简化表格或人工处理 |
| 43012 | 批量任务数超限 | 减少批量任务数（≤50） |

**错误响应示例**：

```json
{
  "code": 43005,
  "message": "图片过于模糊",
  "data": {
    "errorCode": "OCR_IMAGE_BLURRY",
    "details": {
      "blurScore": 85,
      "threshold": 60,
      "suggestion": "请保持手机稳定，重新拍摄清晰图片"
    }
  },
  "timestamp": 1704067200000
}
```

### 7.5 意图理解错误码

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 44001 | 输入文本为空 | 提供有效的文本内容 |
| 44002 | 文本长度超限 | 缩短文本长度（≤500字） |
| 44003 | 无法识别意图 | 尝试更清晰地表达 |
| 44004 | 意图置信度过低 | 提供更多上下文信息 |
| 44005 | 未找到匹配实体 | 检查实体类型是否正确 |
| 44006 | 会话上下文已过期 | 创建新会话 |
| 44007 | 不支持的领域 | 使用支持的意图领域 |
| 44008 | 槽位填充失败 | 提供完整的槽位信息 |

**错误响应示例**：

```json
{
  "code": 44003,
  "message": "无法识别意图",
  "data": {
    "errorCode": "NLU_INTENT_NOT_FOUND",
    "details": {
      "inputText": "我想那个啥",
      "confidence": 0.15,
      "threshold": 0.60,
      "suggestion": "请更清楚地说明您的需求，例如：'我想设置用药提醒'、'我想打电话给张三'"
    },
    "alternatives": [
      {
        "intent": "UNKNOWN",
        "confidence": 0.15
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 7.6 对话管理错误码

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 45001 | 会话不存在 | 创建新会话 |
| 45002 | 会话已过期 | 创建新会话 |
| 45003 | 会话已关闭 | 创建新会话 |
| 45004 | 消息类型不支持 | 使用支持的消息类型 |
| 45005 | 消息内容为空 | 提供有效的消息内容 |
| 45006 | 消息长度超限 | 缩短消息长度（≤1000字） |
| 45007 | 对话生成失败 | 稍后重试 |
| 45008 | 上下文丢失 | 提供更多上下文或重新开始对话 |
| 45009 | 并发请求超限 | 等待上一个请求完成 |
| 45010 | WebSocket连接异常 | 重新建立连接 |

**错误响应示例**：

```json
{
  "code": 45002,
  "message": "会话已过期",
  "data": {
    "errorCode": "CHAT_SESSION_EXPIRED",
    "details": {
      "sessionId": "chat_session_1704067200_001",
      "expiredAt": 1704074400000,
      "suggestion": "会话已过期2小时，请创建新会话"
    }
  },
  "timestamp": 1704067200000
}
```

### 7.7 配额和限流错误

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 46001 | ASR配额不足 | 升级套餐或等待配额刷新 |
| 46002 | TTS配额不足 | 升级套餐或等待配额刷新 |
| 46003 | OCR配额不足 | 升级套餐或等待配额刷新 |
| 46004 | NLU配额不足 | 升级套餐或等待配额刷新 |
| 46005 | 对话配额不足 | 升级套餐或等待配额刷新 |
| 46100 | ASR请求频率超限 | 降低请求频率（≤100次/分钟） |
| 46101 | TTS请求频率超限 | 降低请求频率（≤100次/分钟） |
| 46102 | OCR请求频率超限 | 降低请求频率（≤50次/分钟） |
| 46103 | NLU请求频率超限 | 降低请求频率（≤200次/分钟） |
| 46104 | 对话请求频率超限 | 降低请求频率（≤20次/分钟） |

**错误响应示例**：

```json
{
  "code": 46001,
  "message": "ASR配额不足",
  "data": {
    "errorCode": "QUOTA_ASR_INSUFFICIENT",
    "details": {
      "currentUsage": 10000,
      "totalQuota": 10000,
      "resetTime": 1704153600000,
      "resetTimeText": "2025-01-02 00:00:00"
    },
    "upgradeOptions": [
      {
        "plan": "PREMIUM",
        "quota": 50000,
        "price": 299
      }
    ]
  },
  "timestamp": 1704067200000
}
```

### 7.8 业务逻辑错误

| 错误码 | 说明 | 解决方案 |
|:------|:-----|:---------|
| 47001 | 用户未绑定家庭 | 先完成家庭绑定 |
| 47002 | 药品信息不完整 | 补充完整的药品信息 |
| 47003 | 提醒时间无效 | 设置有效的提醒时间 |
| 47004 | 联系人不存在 | 添加联系人后重试 |
| 47005 | 健康数据异常 | 检查数据有效性 |
| 47006 | 紧急联系人未设置 | 设置紧急联系人 |

**错误响应示例**：

```json
{
  "code": 47003,
  "message": "提醒时间无效",
  "data": {
    "errorCode": "INVALID_REMINDER_TIME",
    "details": {
      "inputTime": "2025-01-01 08:00:00",
      "currentTime": "2025-01-02 10:00:00",
      "reason": "提醒时间不能早于当前时间",
      "suggestion": "请设置未来的时间"
    }
  },
  "timestamp": 1704067200000
}
```

---

## 附录：完整错误码速查表

| 范围 | 模块 | 说明 |
|:-----|:-----|:-----|
| 40000-40999 | 通用错误 | 参数错误、认证错误、权限错误等 |
| 41000-41999 | 语音识别 | ASR相关错误 |
| 42000-42999 | 语音合成 | TTS相关错误 |
| 43000-43999 | OCR识别 | 图片识别相关错误 |
| 44000-44999 | 意图理解 | NLU相关错误 |
| 45000-45999 | 对话管理 | 对话会话相关错误 |
| 46000-46999 | 配额限流 | 配额和频率限制相关错误 |
| 47000-47999 | 业务逻辑 | 业务规则相关错误 |
| 50000-50999 | 服务器错误 | 服务器内部错误 |
