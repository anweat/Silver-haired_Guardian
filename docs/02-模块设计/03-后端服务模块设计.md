# 银龄守候·双模交互版 - 后端服务模块设计

> 文档版本：v1.0  
> 更新日期：2025年12月21日  
> 文档状态：已完成

---

## 目录

- [1. 服务架构概述](#1-服务架构概述)
- [2. 微服务划分](#2-微服务划分)
- [3. 用户服务模块](#3-用户服务模块)
- [4. 消息推送服务](#4-消息推送服务)
- [5. 数据同步服务](#5-数据同步服务)
- [6. 安全防护服务](#6-安全防护服务)
- [7. 技术选型与框架](#7-技术选型与框架)

---

## 1. 服务架构概述

### 1.1 架构设计原则

| 原则 | 说明 | 实现方式 |
|:----|:----|:--------|
| **高可用** | 服务99.9%可用性 | 多实例部署、健康检查、故障转移 |
| **高性能** | API响应<200ms | 缓存优化、数据库索引、异步处理 |
| **可扩展** | 支持水平扩展 | 微服务架构、无状态设计 |
| **安全性** | 数据传输加密 | HTTPS、JWT认证、数据脱敏 |
| **可维护** | 快速定位问题 | 统一日志、链路追踪、监控告警 |

### 1.2 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              接入层                                      │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐              │
│  │   Nginx      │    │  API Gateway │    │   WebSocket  │              │
│  │  (负载均衡)   │    │   (Kong)     │    │   Gateway    │              │
│  └──────┬───────┘    └──────┬───────┘    └──────┬───────┘              │
└─────────┼───────────────────┼───────────────────┼───────────────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              服务层                                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │  用户    │  │  健康    │  │  消息    │  │  安全    │  │   AI     │ │
│  │  服务    │  │  服务    │  │  服务    │  │  服务    │  │  服务    │ │
│  │ (user)  │  │(health) │  │  (msg)  │  │(security)│  │  (ai)   │ │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘ │
│       │             │             │             │             │        │
│       └─────────────┴─────────────┴─────────────┴─────────────┘        │
│                                   │                                     │
│                          ┌────────▼────────┐                           │
│                          │   Nacos 注册中心  │                           │
│                          └─────────────────┘                           │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              数据层                                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │  MySQL   │  │  Redis   │  │ RabbitMQ │  │   OSS    │  │   ES     │ │
│  │ (主从)   │  │  (集群)  │  │  (集群)  │  │(对象存储)│  │ (日志)  │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.3 服务通信方式

| 场景 | 通信方式 | 协议 | 说明 |
|:----|:--------|:----|:----|
| 同步调用 | HTTP | RESTful | 服务间同步请求 |
| 异步消息 | MQ | AMQP | 解耦、削峰填谷 |
| 实时推送 | WebSocket | WS | 实时消息推送 |
| 服务发现 | Nacos | HTTP | 服务注册与发现 |

## 2. 微服务划分

### 2.1 服务清单

| 服务名 | 端口 | 职责 | 依赖 |
|:------|:----|:----|:----|
| silver-gateway | 8080 | API网关、路由、鉴权 | Nacos, Redis |
| silver-user | 8081 | 用户管理、认证授权 | MySQL, Redis |
| silver-health | 8082 | 健康管理、用药提醒 | MySQL, Redis, MQ |
| silver-msg | 8083 | 消息推送、语音留言 | MySQL, Redis, MQ, OSS |
| silver-security | 8084 | 安全防护、诈骗预警 | MySQL, Redis, 第三方 |
| silver-ai | 8085 | AI能力封装、调度 | Redis, 第三方AI |
| silver-job | 8086 | 定时任务、批处理 | MySQL, MQ |

### 2.2 服务依赖关系

```
                    ┌─────────────┐
                    │   Gateway   │
                    └──────┬──────┘
                           │
       ┌───────────────────┼───────────────────┐
       │                   │                   │
       ▼                   ▼                   ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    User     │     │   Health    │     │     Msg     │
└──────┬──────┘     └──────┬──────┘     └──────┬──────┘
       │                   │                   │
       │            ┌──────┴──────┐            │
       │            ▼             ▼            │
       │     ┌─────────────┐ ┌─────────────┐   │
       └────►│  Security   │ │     AI      │◄──┘
             └─────────────┘ └─────────────┘
```

### 2.3 Maven模块结构

```
silver-age/
├── pom.xml                          # 父POM
├── silver-common/                   # 公共模块
│   ├── silver-common-core/          # 核心工具类
│   ├── silver-common-redis/         # Redis封装
│   ├── silver-common-mybatis/       # MyBatis封装
│   └── silver-common-security/      # 安全组件
├── silver-gateway/                  # 网关服务
├── silver-user/                     # 用户服务
│   ├── silver-user-api/             # 对外接口
│   └── silver-user-service/         # 服务实现
├── silver-health/                   # 健康服务
│   ├── silver-health-api/
│   └── silver-health-service/
├── silver-msg/                      # 消息服务
│   ├── silver-msg-api/
│   └── silver-msg-service/
├── silver-security/                 # 安全服务
│   ├── silver-security-api/
│   └── silver-security-service/
├── silver-ai/                       # AI服务
│   ├── silver-ai-api/
│   └── silver-ai-service/
└── silver-job/                      # 定时任务
```

## 3. 用户服务模块

### 3.1 功能职责

| 功能 | 说明 |
|:----|:----|
| 用户注册 | 手机号注册、验证码校验 |
| 用户登录 | 密码/验证码登录、Token管理 |
| 用户管理 | 用户信息CRUD、头像上传 |
| 家庭管理 | 家庭创建、成员绑定、权限管理 |
| 联系人管理 | 老年端常用联系人配置 |

### 3.2 核心实体设计

```java
// 用户实体
@Entity
@Table(name = "t_user")
public class User {
    @Id
    private Long id;
    private String phone;           // 手机号（加密存储）
    private String password;        // 密码（BCrypt）
    private String nickname;        // 昵称
    private String avatar;          // 头像URL
    private UserType userType;      // ELDER/CHILD
    private Integer status;         // 0-禁用 1-正常
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
}

// 家庭实体
@Entity
@Table(name = "t_family")
public class Family {
    @Id
    private Long id;
    private String familyName;      // 家庭名称
    private Long creatorId;         // 创建者ID
    private String inviteCode;      // 邀请码
    private LocalDateTime createTime;
}

// 家庭成员关系
@Entity
@Table(name = "t_family_member")
public class FamilyMember {
    @Id
    private Long id;
    private Long familyId;
    private Long userId;
    private MemberRole role;        // ADMIN/MEMBER
    private String relation;        // 与老人关系
    private LocalDateTime joinTime;
}

// 老年端联系人
@Entity
@Table(name = "t_elder_contact")
public class ElderContact {
    @Id
    private Long id;
    private Long elderId;           // 老人ID
    private String name;            // 显示名称
    private String phone;           // 电话
    private String avatar;          // 头像
    private String relation;        // 关系
    private Boolean isEmergency;    // 紧急联系人
    private Integer sortOrder;      // 排序
}
```

### 3.3 核心接口

```java
@RestController
@RequestMapping("/api/v1/user")
public class UserController {
    
    @PostMapping("/register")
    public Result<UserVO> register(@RequestBody RegisterDTO dto);
    
    @PostMapping("/login")
    public Result<LoginVO> login(@RequestBody LoginDTO dto);
    
    @PostMapping("/logout")
    public Result<Void> logout();
    
    @GetMapping("/info")
    public Result<UserVO> getUserInfo();
    
    @PutMapping("/info")
    public Result<UserVO> updateUserInfo(@RequestBody UpdateUserDTO dto);
}

@RestController
@RequestMapping("/api/v1/family")
public class FamilyController {
    
    @PostMapping("/create")
    public Result<FamilyVO> createFamily(@RequestBody CreateFamilyDTO dto);
    
    @PostMapping("/join")
    public Result<Void> joinFamily(@RequestBody JoinFamilyDTO dto);
    
    @GetMapping("/members")
    public Result<List<FamilyMemberVO>> getMembers();
    
    @DeleteMapping("/member/{memberId}")
    public Result<Void> removeMember(@PathVariable Long memberId);
}
```

## 4. 消息推送服务

### 4.1 功能职责

| 功能 | 说明 |
|:----|:----|
| 语音留言 | 语音消息存储、转发、播放状态 |
| 消息推送 | APP推送（极光/Firebase） |
| 实时通信 | WebSocket长连接管理 |
| 提醒服务 | 用药提醒、生活提醒 |

### 4.2 消息类型定义

```java
public enum MessageType {
    VOICE_MESSAGE,      // 语音留言
    TEXT_MESSAGE,       // 文本消息
    MEDICATION_REMINDER,// 用药提醒
    SECURITY_ALERT,     // 安全预警
    SYSTEM_NOTICE       // 系统通知
}

@Entity
@Table(name = "t_message")
public class Message {
    @Id
    private Long id;
    private Long senderId;
    private Long receiverId;
    private MessageType type;
    private String content;         // 文本内容/语音URL
    private Integer duration;       // 语音时长(秒)
    private MessageStatus status;   // UNREAD/READ/DELETED
    private LocalDateTime sendTime;
    private LocalDateTime readTime;
}
```

### 4.3 推送服务实现

```java
@Service
public class PushService {
    
    @Autowired
    private JPushClient jpushClient;
    
    /**
     * 推送消息到指定用户
     */
    public void pushToUser(Long userId, PushMessage message) {
        // 获取用户设备信息
        UserDevice device = deviceService.getDevice(userId);
        
        // 构建推送内容
        PushPayload payload = PushPayload.newBuilder()
            .setPlatform(Platform.all())
            .setAudience(Audience.registrationId(device.getRegistrationId()))
            .setNotification(Notification.newBuilder()
                .setAlert(message.getTitle())
                .addPlatformNotification(AndroidNotification.newBuilder()
                    .setTitle(message.getTitle())
                    .setAlert(message.getContent())
                    .addExtras(message.getExtras())
                    .build())
                .build())
            .build();
        
        // 发送推送
        jpushClient.sendPush(payload);
    }
    
    /**
     * 推送紧急预警（高优先级）
     */
    public void pushUrgentAlert(Long userId, SecurityAlert alert) {
        // 紧急推送，需要同时触发电话回拨
        pushToUser(userId, PushMessage.urgent(alert));
        
        // 异步触发电话提醒
        asyncService.triggerPhoneCallback(userId, alert);
    }
}
```

### 4.4 WebSocket服务

```java
@ServerEndpoint("/ws/{token}")
@Component
public class WebSocketServer {
    
    private static ConcurrentHashMap<Long, Session> sessionPool = new ConcurrentHashMap<>();
    
    @OnOpen
    public void onOpen(Session session, @PathParam("token") String token) {
        // 验证Token，获取用户ID
        Long userId = tokenService.validateAndGetUserId(token);
        if (userId != null) {
            sessionPool.put(userId, session);
            log.info("用户{}建立WebSocket连接", userId);
        }
    }
    
    @OnClose
    public void onClose(Session session) {
        // 移除连接
        sessionPool.entrySet().removeIf(entry -> entry.getValue().equals(session));
    }
    
    @OnMessage
    public void onMessage(String message, Session session) {
        // 处理客户端消息
        WSMessage wsMessage = JSON.parseObject(message, WSMessage.class);
        handleMessage(wsMessage, session);
    }
    
    /**
     * 发送消息给指定用户
     */
    public static void sendToUser(Long userId, WSMessage message) {
        Session session = sessionPool.get(userId);
        if (session != null && session.isOpen()) {
            session.getAsyncRemote().sendText(JSON.toJSONString(message));
        }
    }
    
    /**
     * 广播消息给家庭所有成员
     */
    public static void broadcastToFamily(Long familyId, WSMessage message) {
        List<Long> memberIds = familyService.getMemberIds(familyId);
        memberIds.forEach(userId -> sendToUser(userId, message));
    }
}
```

## 5. 数据同步服务

### 5.1 同步策略

| 数据类型 | 同步方式 | 触发时机 | 说明 |
|:--------|:--------|:--------|:----|
| 用户状态 | 实时推送 | 状态变化时 | WebSocket推送 |
| 用药记录 | 实时+定时 | 记录产生/每日汇总 | MQ异步 |
| 安全事件 | 实时推送 | 事件发生时 | 高优先级推送 |
| 识别记录 | 异步同步 | 识别完成后 | MQ异步 |

### 5.2 消息队列设计

```java
// 队列定义
public class MQConstants {
    // 交换机
    public static final String EXCHANGE_SILVER = "silver.exchange";
    
    // 队列
    public static final String QUEUE_MEDICATION = "silver.medication";
    public static final String QUEUE_SECURITY = "silver.security";
    public static final String QUEUE_RECOGNITION = "silver.recognition";
    public static final String QUEUE_NOTIFICATION = "silver.notification";
    
    // 路由键
    public static final String ROUTING_MEDICATION = "medication.#";
    public static final String ROUTING_SECURITY = "security.#";
}

// 消息生产者
@Component
public class MessageProducer {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void sendMedicationRecord(MedicationRecord record) {
        rabbitTemplate.convertAndSend(
            MQConstants.EXCHANGE_SILVER,
            "medication.record",
            record
        );
    }
    
    public void sendSecurityAlert(SecurityAlert alert) {
        rabbitTemplate.convertAndSend(
            MQConstants.EXCHANGE_SILVER,
            "security.alert",
            alert
        );
    }
}

// 消息消费者
@Component
public class MessageConsumer {
    
    @RabbitListener(queues = MQConstants.QUEUE_MEDICATION)
    public void handleMedicationRecord(MedicationRecord record) {
        // 1. 更新数据库
        medicationService.saveRecord(record);
        
        // 2. 通知子女端
        Long familyId = userService.getFamilyId(record.getElderId());
        List<Long> childIds = familyService.getChildIds(familyId);
        childIds.forEach(childId -> {
            pushService.pushToUser(childId, PushMessage.medication(record));
        });
    }
    
    @RabbitListener(queues = MQConstants.QUEUE_SECURITY)
    public void handleSecurityAlert(SecurityAlert alert) {
        // 1. 保存安全事件
        securityService.saveAlert(alert);
        
        // 2. 实时推送给所有家庭成员
        webSocketServer.broadcastToFamily(alert.getFamilyId(), 
            WSMessage.securityAlert(alert));
        
        // 3. APP推送
        pushService.pushUrgentAlert(alert);
    }
}
```

### 5.3 缓存设计

```java
@Service
public class CacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // 缓存Key定义
    private static final String KEY_USER_INFO = "user:info:";
    private static final String KEY_FAMILY_MEMBERS = "family:members:";
    private static final String KEY_ELDER_STATUS = "elder:status:";
    private static final String KEY_TOKEN = "token:";
    
    /**
     * 缓存用户信息
     */
    public void cacheUserInfo(Long userId, UserVO user) {
        redisTemplate.opsForValue().set(
            KEY_USER_INFO + userId,
            user,
            Duration.ofHours(24)
        );
    }
    
    /**
     * 缓存老人状态（实时更新）
     */
    public void cacheElderStatus(Long elderId, ElderStatus status) {
        redisTemplate.opsForValue().set(
            KEY_ELDER_STATUS + elderId,
            status,
            Duration.ofMinutes(5)  // 5分钟过期，防止数据不一致
        );
    }
    
    /**
     * 获取老人状态
     */
    public ElderStatus getElderStatus(Long elderId) {
        return (ElderStatus) redisTemplate.opsForValue()
            .get(KEY_ELDER_STATUS + elderId);
    }
}
```

## 6. 安全防护服务

### 6.1 功能职责

| 功能 | 说明 |
|:----|:----|
| 号码检测 | 对接第三方诈骗号码库 |
| 来电预警 | 实时检测来电风险 |
| 事件记录 | 安全事件存储与分析 |
| 预警推送 | 向家庭成员推送预警 |

### 6.2 诈骗检测流程

```
┌─────────────────────────────────────────────────────────────┐
│                     诈骗电话检测流程                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   老年端来电                                                 │
│       │                                                     │
│       ▼                                                     │
│   ┌─────────────┐                                          │
│   │  获取来电号码 │                                          │
│   └──────┬──────┘                                          │
│          │                                                  │
│          ▼                                                  │
│   ┌─────────────┐     ┌─────────────┐                      │
│   │ 本地缓存查询 │────►│ 命中缓存?   │                      │
│   └─────────────┘     └──────┬──────┘                      │
│                              │                              │
│              ┌───────────────┼───────────────┐              │
│              ▼ 是            ▼ 否            │              │
│       ┌─────────────┐  ┌─────────────┐      │              │
│       │ 返回缓存结果 │  │ 调用第三方API│      │              │
│       └─────────────┘  └──────┬──────┘      │              │
│                               │              │              │
│                               ▼              │              │
│                        ┌─────────────┐      │              │
│                        │  更新缓存    │      │              │
│                        └──────┬──────┘      │              │
│                               │              │              │
│              ┌────────────────┘              │              │
│              ▼                               │              │
│       ┌─────────────┐                       │              │
│       │ 判断风险等级 │                       │              │
│       └──────┬──────┘                       │              │
│              │                               │              │
│    ┌─────────┼─────────┐                    │              │
│    ▼         ▼         ▼                    │              │
│  高风险    中风险    低风险                  │              │
│    │         │         │                    │              │
│    ▼         ▼         ▼                    │              │
│  拦截+预警  提醒     放行                    │              │
│                                             │              │
└─────────────────────────────────────────────────────────────┘
```

### 6.3 安全服务实现

```java
@Service
public class SecurityService {
    
    @Autowired
    private PhoneCheckClient phoneCheckClient;  // 第三方号码检测
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * 检测电话号码风险
     */
    public PhoneRiskResult checkPhoneRisk(String phone) {
        // 1. 先查本地缓存
        String cacheKey = "phone:risk:" + phone;
        PhoneRiskResult cached = (PhoneRiskResult) redisTemplate.opsForValue().get(cacheKey);
        if (cached != null) {
            return cached;
        }
        
        // 2. 调用第三方API
        PhoneRiskResult result = phoneCheckClient.check(phone);
        
        // 3. 缓存结果（24小时）
        redisTemplate.opsForValue().set(cacheKey, result, Duration.ofHours(24));
        
        return result;
    }
    
    /**
     * 处理来电事件
     */
    public void handleIncomingCall(Long elderId, String phone) {
        // 1. 检测风险
        PhoneRiskResult risk = checkPhoneRisk(phone);
        
        // 2. 记录事件
        SecurityEvent event = SecurityEvent.builder()
            .elderId(elderId)
            .phone(phone)
            .riskLevel(risk.getLevel())
            .riskType(risk.getType())
            .time(LocalDateTime.now())
            .build();
        securityEventMapper.insert(event);
        
        // 3. 根据风险等级处理
        if (risk.getLevel() == RiskLevel.HIGH) {
            // 高风险：推送紧急预警
            alertFamilyMembers(elderId, event);
        } else if (risk.getLevel() == RiskLevel.MEDIUM) {
            // 中风险：推送提醒
            notifyFamilyMembers(elderId, event);
        }
    }
    
    /**
     * 紧急预警推送
     */
    private void alertFamilyMembers(Long elderId, SecurityEvent event) {
        Long familyId = userService.getFamilyId(elderId);
        List<Long> memberIds = familyService.getMemberIds(familyId);
        
        for (Long memberId : memberIds) {
            // WebSocket实时推送
            WebSocketServer.sendToUser(memberId, WSMessage.urgentAlert(event));
            
            // APP推送
            pushService.pushUrgentAlert(memberId, event);
        }
    }
}
```

## 7. 技术选型与框架

### 7.1 技术栈详情

| 类别 | 技术 | 版本 | 说明 |
|:----|:----|:----|:----|
| JDK | OpenJDK | 17 | LTS版本 |
| 框架 | Spring Boot | 3.2.x | 基础框架 |
| 微服务 | Spring Cloud Alibaba | 2022.0.x | 微服务套件 |
| ORM | MyBatis-Plus | 3.5.x | 数据库访问 |
| 数据库 | MySQL | 8.0+ | 关系型数据库 |
| 缓存 | Redis | 7.x | 缓存/会话 |
| 消息队列 | RabbitMQ | 3.12+ | 异步消息 |
| 注册中心 | Nacos | 2.3.x | 服务发现+配置 |
| 网关 | Spring Cloud Gateway | 4.1.x | API网关 |
| 对象存储 | 阿里云OSS | - | 文件存储 |
| 搜索 | Elasticsearch | 8.x | 日志/搜索 |
| 定时任务 | XXL-Job | 2.4.x | 分布式调度 |

### 7.2 项目依赖配置

```xml
<!-- pom.xml (父POM) -->
<properties>
    <java.version>17</java.version>
    <spring-boot.version>3.2.2</spring-boot.version>
    <spring-cloud.version>2023.0.0</spring-cloud.version>
    <spring-cloud-alibaba.version>2022.0.0.0</spring-cloud-alibaba.version>
    <mybatis-plus.version>3.5.5</mybatis-plus.version>
</properties>

<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>${spring-boot.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>${spring-cloud.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-alibaba-dependencies</artifactId>
            <version>${spring-cloud-alibaba.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

### 7.3 配置中心

```yaml
# application.yml (Nacos配置)
spring:
  application:
    name: silver-user
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
      config:
        server-addr: ${NACOS_SERVER:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        file-extension: yaml

  datasource:
    url: jdbc:mysql://${MYSQL_HOST:127.0.0.1}:3306/silver_user?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: ${MYSQL_USER:root}
    password: ${MYSQL_PASSWORD:123456}
    
  redis:
    host: ${REDIS_HOST:127.0.0.1}
    port: 6379
    password: ${REDIS_PASSWORD:}
    
  rabbitmq:
    host: ${MQ_HOST:127.0.0.1}
    port: 5672
    username: ${MQ_USER:guest}
    password: ${MQ_PASSWORD:guest}

mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  configuration:
    map-underscore-to-camel-case: true
```

### 7.4 Docker部署配置

```yaml
# docker-compose.yml
version: '3.8'
services:
  # MySQL
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: silver_age
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      
  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
      
  # RabbitMQ
  rabbitmq:
    image: rabbitmq:3.12-management
    ports:
      - "5672:5672"
      - "15672:15672"
      
  # Nacos
  nacos:
    image: nacos/nacos-server:v2.3.0
    environment:
      MODE: standalone
    ports:
      - "8848:8848"
      
  # 应用服务
  silver-gateway:
    build: ./silver-gateway
    ports:
      - "8080:8080"
    depends_on:
      - nacos
      - redis
      
  silver-user:
    build: ./silver-user/silver-user-service
    ports:
      - "8081:8081"
    depends_on:
      - mysql
      - redis
      - nacos

volumes:
  mysql_data:
  redis_data:
```
